<FileChoosePopup>:
    title: "Choose a .CSV File"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser
            multiselect: True
            path: "/home/flep98/Desktop/PhD_Project/"
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Load"
                on_release: root.load(filechooser.selection)
                id: ldbtn
                disabled: True if filechooser.selection==[] else False

<FileSavePopup>:
    title: "Save Kinematic Data"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser_save
            multiselect: False
            dirselect: True
            filters: ['']
            FileChooserIconLayout:
                on_touch_down: root.load_filepath_to_view(filechooser_save.selection)

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20

            TextInput:
                id: filename_save
                height: 30
                multiline: False

            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Save"
                on_release:
                    app.save_kinematics(root.ids.filename_save.text,filechooser_save.selection)
                    root.dismiss()
                id: save_button
                disabled: True if filechooser_save.selection==[] else False

<FileImportPopup>:
    title: "Import Kinematic Data"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser_save
            multiselect: False
            dirselect: True
            filters: ['']
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20

            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Import"
                on_release:
                    app.import_kinematics(filechooser_save.selection)
                    root.dismiss()
                id: save_button
                disabled: True if filechooser_save.selection==[] else False

<ModelFits>:
    do_default_tab: False

    TabbedPanelItem:
        text: 'Import'
        background_color: (1, .5, 0, 1)
        background_normal: ''
        StackLayout:
            orientation: 'lr-tb'
            size_hint_y: None
            height: 30
            spacing: 5
            Label:
                text: 'UV-Fits files (.uvf files)'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("uvf")
            TextInput:
                id: get_file_uvf
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
            Label:
                text: 'Modelfit Images (.fits files)'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("modelfit")
            TextInput:
                id: get_file_modelfit
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
            Label:
                text: 'Clean Images (.fits files)'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("clean")
            TextInput:
                id: get_file_clean
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
            Label:
                text: 'Stokes Q Images (.fits files, if not included in clean .fits)'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("stokes_q")
            TextInput:
                id: get_file_stokes_q
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
            Label:
                text: 'Stokes U Images (.fits files, if not included in clean .fits)'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("stokes_u")
            TextInput:
                id: get_file_stokes_u
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
            Label:
                text: 'CASA CLEAN model (.fits file from exportfits("file.model"))'
                size_hint_x: 1
            Label:
                text: ''
                size_hint_x: 0.2
            Button:
                text: 'Choose File'
                size_hint_x: 0.2
                on_press: root.open_popup("casa_clean_model")
            TextInput:
                id: get_file_casa_clean_model
                readonly: True
                size_hint_x: 0.4
            Label:
                text: ''
                size_hint_x: 0.2
    TabbedPanelItem:
        text: 'Kinematics'
        background_color: (1, .5, 0, 1)
        background_normal: ''
        BoxLayout:
            id: main_box
            orientation: 'vertical'
            Button:
                text: 'Load Files'
                size_hint_x: 0.2
                size_hint_y: 0.05
                on_release: root.create_kinematic_plots()
            BoxLayout:
                orientation: 'horizontal'
                padding: 50
                BoxLayout:
                    id: box_top_left
                    orientation: 'vertical'
                    ScrollView:
                        size: self.size
                        size_hint_y: 0.9
                        id: scroll_component
                        GridLayout:
                            size_hint_y: None
                            cols: 1
                            id: component_list
                            height: self.minimum_height
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: 0.1
                        Button:
                            text:"Add"
                            on_release:app.add_component()
                        Button:
                            text:"Remove"
                            on_release: app.remove_component()
                        Button:
                            text:"Reset Index (not implemented)"
                        Button:
                            text:"Set Core"
                            on_release:app.set_core_component()
                BoxLayout:
                    id: box_top_center
                    orientation: "vertical"
                    BoxLayout:
                        size_hint_y: 0.1
                        Button:
                            size_hint_x: 0.2
                            text:"Export Data"
                            on_release:
                                root.open_save_dialog()
                        Button:
                            size_hint_x: 0.2
                            text:"Import Data"
                            on_release:
                                root.open_import_dialog()
                        TextInput:
                            size_hint_x: 0.2
                            id: redshift
                            text: "0.00"
                            on_text: app.update_redshift()
                            multiline: False
                        Button:
                            size_hint_x: 0.4
                            text:"Get Redshift from NED"
                            on_release: app.get_redshift()

                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: 0.7
                        BoxLayout:
                            size_hint_y: 0.1
                            orientation: "horizontal"
                            Label:
                                text: "Component ID"
                            Label:
                                text: "Speed (mas/yr)"
                            Label:
                                text: "⁠β_app (c)"
                            Label:
                                text: "D_crit"
                        ScrollView:
                            size: self.size
                            size_hint_y: 0.9
                            id: scroll_kinematic
                            GridLayout:
                                size_hint_y: None
                                cols: 1
                                id: kinematic_list
                                height: self.minimum_height
                    BoxLayout:
                        size_hint_y: 0.1
                        orientation: "horizontal"
                        Label:
                            text: "RA min"
                        TextInput:
                            id: input_ra_min
                        Label:
                            text: "RA max"
                        TextInput:
                            id: input_ra_max
                        Label:
                            text: "DEC min"
                        TextInput:
                            id: input_dec_min
                        Label:
                            text: "DEC max"
                        TextInput:
                            id: input_dec_max
                        Button:
                            text: "Apply"
                            on_release: root.change_plot_lims()
                    BoxLayout:
                        size_hint_y: 0.1
                        Button:
                            text:"Home"
                            on_release: app.home_plot()
                        ToggleButton:
                            group:'touch_mode'
                            text:"Zoom Mode"
                            on_release:
                                app.set_touch_mode('zoombox')
                                self.state='down'
                        ToggleButton:
                            group:'touch_mode'
                            text:"Pick Component"
                            on_release:
                                app.set_touch_mode('pointselect')
                                self.state='down'
                BoxLayout:
                    orientation:"vertical"
                    id: box_top_right
                    MatplotFigure:
                        id: kinematic_plot
                    BoxLayout:
                        size_hint_y: 0.1
                        ToggleButton:
                            group:'kinematic_select'
                            id: kinematic_choose
                            text:"Kinematic"
                            state: "down"
                            on_release:
                                app.update_kinematic_plot()
                                self.state='down'
                        ToggleButton:
                            group:'kinematic_select'
                            text:"Flux Density"
                            id: flux_choose
                            on_release:
                                app.update_kinematic_plot()
                                self.state='down'
                        ToggleButton:
                            group:'kinematic_select'
                            text:"Brightness Temperature"
                            id: tb_choose
                            on_release:
                                app.update_kinematic_plot()
                                self.state='down'
            ScrollView:
                id: figure_scroll
                do_scroll_y: False
                do_scroll_x: True
                size: self.size
                scroll_type: ['bars','content']
                padding: 50
                GridLayout:
                    size_hint_x: None
                    rows: 1
                    id: figures
                    spacing: 50
                    width: self.minimum_width

    TabbedPanelItem:
        text: 'Stacking'
        background_color: (1, .5, 0, 1)
        background_normal: ''
        BoxLayout:
            id: stacking_box
            orientation: 'vertical'
            Button:
                text: 'Load Files'
                size_hint_x: 0.2
                size_hint_y: 0.05
                on_release: root.load_stacking_files()
            BoxLayout:
                orientation: 'horizontal'
                padding: 50
                BoxLayout:
                    id: box_top_left_stacking
                    orientation: 'vertical'
                    MatplotFigure:
                        id: stacking_single_plot
                    BoxLayout:
                        orientation: "horizontal"
                        size_hint_y: 0.1
                        Label:
                            text: "File List"
                            size_hint_x: 0.9
                        Label:
                            text: "Stack?"
                            size_hint_x: 0.1
                    ScrollView:
                        size: self.size
                        size_hint_y: 0.9
                        id: scroll_files
                        GridLayout:
                            size_hint_y: None
                            cols: 2
                            id: stacking_single_list
                            height: self.minimum_height
                BoxLayout:
                    id: box_top_center_stacking
                    orientation: "vertical"
                    Label:
                        text: "Stacking Settings"
                        size_hint_y:0.1
                    BoxLayout:
                        size_hint_y:0.05
                        orientation: "horizontal"
                        Label:
                            text: "DIFMAP location"
                        TextInput:
                            text:'/usr/local/difmap/uvf_difmap_2.5g'
                            id: difmap_path
                    BoxLayout:
                        size_hint_y:0.05
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint_y: 0.05
                        Label:
                            size_hint_x: 0.1
                            text: "MAJ"
                        TextInput:
                            size_hint_x: 0.1
                            id: beam_maj
                            text: ""
                        Label:
                            size_hint_x: 0.1
                            text: "MIN"
                        TextInput
                            size_hint_x: 0.1
                            id: beam_min
                            text: ""
                        Label:
                            size_hint_x: 0.1
                            text: "POS"
                        TextInput:
                            size_hint_x: 0.1
                            id: beam_pos
                            text: ""
                        Button:
                            size_hint_x: 0.3
                            text: "Get Common Beam"
                            on_release: root.fill_in_common_beam()
                    BoxLayout:
                        size_hint_y:0.05
                    BoxLayout:
                        size_hint_y:0.4
                        GridLayout:
                            size_hint_y:1
                            cols:4
                            CheckBox:
                                id: restore_beam_check
                            Label
                            Label:
                                text: "Restore with beam? (requires DIFMAP)"
                            Label
                            CheckBox:
                                id: do_alignment_check
                                active: True
                            Label:
                                text: "Align Images?"
                            CheckBox:
                                id: stack_stokes_check
                                group: "stack_mode"
                                active: True
                            Label:
                                text: "Stack I,Q,U"
                            CheckBox:
                                id: weighted_check
                            Label:
                                text: "Weight EVPA stack by lin. pol.?"
                            CheckBox:
                                id: stack_pol_check
                                group: "stack_mode"
                            Label:
                                text: "Stack I, lin. Pol, EVPA"
                    Button:
                        size_hint_y:0.1
                        text: "Do Stacking"
                        on_release: root.stack_images()
                    BoxLayout:
                        size_hint_y:0.2
                BoxLayout
                    id: box_top_right_stacking
                    orientation: "vertical"
                    MatplotFigure:
                        size_hint_y: 0.5
                        id: stacked_image
                    BoxLayout:
                        size_hint_y:0.1
                        orientation: "horizontal"
                        ToggleButton:
                            id: stacked_image_i
                            text: "Stokes I"
                            group: "select_stacked_image"
                            on_release:
                                root.change_final_stack_plot("stokes_i",self)
                        ToggleButton:
                            id: stacked_image_linpol
                            text: "Lin. Pol."
                            group: "select_stacked_image"
                            on_release:
                                root.change_final_stack_plot("lin_pol",self)
                        ToggleButton:
                            id: stacked_image_fracpol
                            text: "Frac. Pol."
                            group: "select_stacked_image"
                            on_release:
                                root.change_final_stack_plot("frac_pol",self)
                    BoxLayout:
                        size_hint_y:0.4
    TabbedPanelItem:
        text: 'Plotting'
        background_color: (1, .5, 0, 1)
        background_normal: ''
        BoxLayout:
            id: plotting_box
            orientation: 'vertical'
            Button:
                text: 'Load Files'
                size_hint_x: 0.2
                size_hint_y: 0.05
                on_release: root.load_plotting_files()
            BoxLayout:
                orientation:'horizontal'
                size_hint_y: 0.55
                BoxLayout:
                    id: box_top_left_plotting
                    padding: 20
                    orientation: 'vertical'
                    size_hint_x: 0.3
                    BoxLayout:
                        orientation: "horizontal"
                        size_hint_y: 0.1
                        Label:
                            text: "File List"
                            size_hint_x: 0.9
                        Label:
                            text: "Export?"
                            size_hint_x: 0.1
                    ScrollView:
                        size: self.size
                        size_hint_y: 0.9
                        id: scroll_plotting_files
                        GridLayout:
                            size_hint_y: None
                            cols: 2
                            id: plotting_single_list
                            height: self.minimum_height
                BoxLayout:
                    id: box_top_center_plotting
                    padding: 20
                    orientation: 'vertical'
                    size_hint_x: 0.4
                    MatplotFigure:
                        id: plotting_single_plot
                BoxLayout:
                    id: box_top_right_plotting
                    padding: 20
                    orientation: 'vertical'
                    size_hint_x: 0.3
                    BoxLayout:
                        orientation: "horizontal"
                        size_hint_y: 0.1
                        Label:
                            text: "File Info"
                            size_hint_x: 1
                    GridLayout:
                        padding: 10
                        size_hint_y: 0.9
                        cols: 2
                        height: self.minimum_height
                        Label:
                            text: "Source Name:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: source_name
                            size_hint_x: 0.4
                        Label:
                            text: "Frequency:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: frequency
                            size_hint_x: 0.4
                        Label:
                            text: "Obs Date:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: obs_date
                            size_hint_x: 0.4
                        Label:
                            text: "Integrated Flux (total image):"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: integrated_flux_image
                            size_hint_x: 0.4
                        Label:
                            text: "Integrated Flux (cleaned):"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: integrated_flux_clean
                            size_hint_x: 0.4
                        Label:
                            text: "Peak Flux:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: peak_flux
                            size_hint_x: 0.4
                        Label:
                            text: "Stokes I Noise:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: stokes_i_noise
                            size_hint_x: 0.4
                        Label:
                            text: "Integrated Pol Flux (total image):"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: integrated_pol_flux_image
                            size_hint_x: 0.4
                        Label:
                            text: "Integrated Pol Flux (cleaned):"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: integrated_pol_flux_clean
                            size_hint_x: 0.4
                        Label:
                            text: "Pol Peak Flux:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: pol_peak_flux
                            size_hint_x: 0.4
                        Label:
                            text: "Pol Noise:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: pol_noise
                            size_hint_x: 0.4
                        Label:
                            text: "Fractional Polarization:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: fractional_polarization
                            size_hint_x: 0.4
                        Label:
                            text: "EVPA:"
                            size_hint_x: 0.6
                        Label:
                            text: ""
                            halign: "left"
                            id: evpa
                            size_hint_x: 0.4
            BoxLayout:
                size_hint_y: 0.4







